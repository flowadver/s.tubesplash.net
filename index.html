<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webview Traffic Test</title>
</head>
<body>
    <h1>Traffic Test</h1>
    <p id="traffic-info">Detecting traffic type...</p>
    
    <div class="webview" style="display: none;">
        <h2>You are using Webview!</h2>
        <p>This content is displayed because you're using a webview environment.</p>
    </div>
    
    <div class="non-webview" style="display: none;">
        <h2>You are NOT using Webview!</h2>
        <p>This content is displayed because you're using a standard browser.</p>
    </div>

    <h3>Tracking Parameters</h3>
    <p>Click ID: <span id="click-id"></span></p>
    <p>Source ID: <span id="source-id"></span></p>
    <p>Sub ID: <span id="sub-id"></span></p>
    <p>Campaign ID: <span id="campaign-id"></span></p>

    <script>
        // Function to detect if the environment is WebView
        function isWebView() {
            var userAgent = navigator.userAgent || navigator.vendor || window.opera;
            return (/(wv|WebView|FBAV|FBAN|FB_IAB|FB4A|FB)/gi).test(userAgent);
        }

        // Display content based on WebView or non-WebView
        if (isWebView()) {
            document.querySelector('.webview').style.display = 'block';
            document.getElementById('traffic-info').innerText = "Webview traffic detected";
        } else {
            document.querySelector('.non-webview').style.display = 'block';
            document.getElementById('traffic-info').innerText = "Non-webview traffic detected";
        }

        // Function to get URL parameters
        function getParameterByName(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // Display tracking parameters from the URL
        document.getElementById('click-id').textContent = getParameterByName('click_id') || 'Not provided';
        document.getElementById('source-id').textContent = getParameterByName('source_id') || 'Not provided';
        document.getElementById('sub-id').textContent = getParameterByName('sub_id') || 'Not provided';
        document.getElementById('campaign-id').textContent = getParameterByName('campaign_id') || 'Not provided';

        // Save report automatically
        function saveReport() {
            const click_id = getParameterByName('click_id') || 'N/A';
            const source_id = getParameterByName('source_id') || 'N/A';
            const sub_id = getParameterByName('sub_id') || 'N/A';
            const campaign_id = getParameterByName('campaign_id') || 'N/A';
            const traffic_type = isWebView() ? 'Webview' : 'Non-Webview';

            const reportData = `Click ID: ${click_id}\nSource ID: ${source_id}\nSub ID: ${sub_id}\nCampaign ID: ${campaign_id}\nTraffic Type: ${traffic_type}\n\n`;

            fetch('https://api.github.com/repos/{your-username}/traffic-report/contents/report.txt', {
                method: 'PUT',
                headers: {
                    'Authorization': 'token YOUR_GITHUB_TOKEN',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: 'New traffic report',
                    content: btoa(reportData), // Convert text to base64
                    sha: null // If file already exists, you will need to get its SHA
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Report saved:', data);
            })
            .catch(error => {
                console.error('Error saving report:', error);
            });
        }

        // Call saveReport automatically
        saveReport();
    </script>
</body>
</html>
